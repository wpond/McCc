
INVENTORY_FILE = "/disk/inventory"
CHESTS_FILE = "/disk/chests"

function startsWith(string, start)
	return string.sub(msg,1,string.len(start)) == start
end

function split(s,divider)
	pieces = {}
	pos = 1
	remaining = s
	while true do
		pos = string.find(remaining,divider)
		if pos == nil then
			if remaining ~= "" then
				pieces[#pieces+1] = remaining
			end
			break
		end
		pieces[#pieces+1] = string.sub(remaining,1,pos)
		remaining = string.sub(remaining,pos+1)
	end
end

function loadInventory()
	
	if fs.exists(INVENTORY_FILE) then
	
		f = fs.open(INVENTORY_FILE,"r")
		
		inventory = textutils.unserialize(f.readLine())
		
		f.close()
	
	else
		inventory = {}
	end
	
end

function saveInventory()
	
	if fs.exists(INVENTORY_FILE) then
		fs.delete(INVENTORY_FILE)
	end
	
	f = fs.open(INVENTORY_FILE,"w")
	
	f.writeLine(textutils.serialize(inventory))
	
	f.close()
	
end

function main()
	
	loadInventory()
	
	rednet.close("right")
	rednet.open("right")

	while true do
		
		id,msg = rednet.receive()
		if startsWith(msg,"chests") then
			
			f = fs.open(CHESTS_FILE,"r")
			while true do
				line = f.readLine()
				if line == nil then
					break
				end
				rednet.send(id,line)
			end
			f.close()
			
		elseif startsWith(msg,"checkin") then
			
			local remainder = string.sub(msg,string.len("checkin "))
			local count = tonumber(string.sub(remainder,1,string.find(remainder," ")))
			local item = tonumber(string.sub(remainder,string.find(remainder," ")))
			
			print(msg)
			print("count = " .. count)
			print("item = " .. item)
			
		elseif startsWith(msg,"checkout") then
			
			
			
		elseif startsWith(msg,"available") then
			
			
			
		end
		
	end

end

main()